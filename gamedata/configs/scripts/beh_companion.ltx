[logic]
active = beh@base
post_combat_time = 0,0

;======================
; default logic
;======================
[beh@general_no_companion]
sound_idle = state
behavior_state = beh_move
target = waypoint
walk_dist = 100
jog_dist = 220
wait_anim = guard
walk_anim = patrol
jog_anim = patrol
run_anim = rush
delay_anim = guard
meet = meet
combat_ignore_cond = {!is_enemy_actor_or_companion} true, false
combat_ignore_keep_when_attacked = true
gather_items_enabled = false
help_wounded_enabled = false
corpse_detection_enabled = false
use_camp = false

[beh@general]
combat_ignore_keep_when_attacked = true
combat_ignore_cond = {=check_enemy_name(actor)} true, {-npcx_beh_ignore_combat -npcx_beh_ignore_actor_enemies}  false, {+npcx_beh_ignore_combat +npcx_beh_ignore_actor_enemies} true, {+npcx_beh_ignore_combat -npcx_beh_ignore_actor_enemies =is_enemy_fighting_actor} false, true
meet = meet
gather_items_enabled = {+npcx_beh_gather_items}true, false
corpse_detection_enabled = {+npcx_beh_loot_corpses} true, false
actor_dialogs = actor_dialogs
behavior_state = {+npcx_beh_wait} beh_wait, beh_move
target = {!is_squad_commander} commander, {=is_squad_commander +npcx_beh_patrol_mode} waypoint, actor
walk_dist = {+npcx_beh_patrol_mode} 90, 4
jog_dist = {+npcx_beh_patrol_mode} 150, 8
run_dist = {+npcx_beh_patrol_mode} 250, {=surge_started} 40, 90
keep_distance = {+npcx_beh_distance_far} far, near
near_desired_dist = {+npcx_beh_patrol_mode =is_squad_commander} 1, {!is_squad_commander} 4, 3
far_desired_dist = {+npcx_beh_patrol_mode =is_squad_commander} 1, {!is_squad_commander} 4, 8
wait_anim = {=is_wounded} nil, {+npcx_beh_substate_stealth} hide, guard
walk_anim = {=is_wounded} nil, {+npcx_beh_patrol_mode -npcx_beh_substate_stealth} patrol,{+npcx_beh_substate_stealth} sneak, patrol
jog_anim = {=is_wounded} nil, {+npcx_beh_substate_stealth} sneak_run, rush
run_anim = {=is_wounded} nil, {+npcx_beh_substate_stealth} assault, assault
sprint_anim = {=is_wounded} nil, {+npcx_beh_substate_stealth} sprint, sprint
delay_anim = {=is_wounded} nil, {+npcx_beh_substate_stealth} hide, random_animation
out_restr = {=actor_in_zone(zat_a2_sr_noweap)} zat_a2_sr_noweap, {=actor_in_zone(jup_a6_sr_noweap)} jup_a6_sr_noweap, {=actor_in_zone(jup_b41_sr_noweap)} jup_b41_sr_noweap
[meet]
;reset_distance = 2
abuse = false
snd_on_use 				= {=is_wounded} nil, {!is_squad_commander} meet_use_no_talk_leader
close_distance          = {=is_wounded} 1, 2
close_anim              = {=is_wounded} nil, {!is_squad_commander} nil, {+npcx_beh_substate_stealth -npcx_beh_substate_relax} hide_no_wpn, guard_na
close_snd_hello         = nil
close_snd_bye           = nil
close_victim			= {=is_wounded} nil, {!is_squad_commander} nil, actor
far_distance			= 0
far_anim				= nil
far_snd					= nil
far_victim				= nil
use 					= {=is_wounded} true, {!is_squad_commander} false, {=dist_to_actor_le(5)} true, false
allow_break				= true
use_text				= nil
trade_enable 			= {=is_wounded} false, true
meet_dialog				= {=is_wounded} axr_companion_medkit, nil

[actor_dialogs]
disable = dm_ordered_task_dialog, dm_traveler_dialog, dm_actor_become_guide_to_companion_dialog, dm_universal_dialog, about_quests_dialog_dolg, about_quests_dialog_freedom, about_quests_dialog_bandit, about_quests_dialog_stalkers

;===============================================
;            		 active sections
;===============================================
;___________________ECOLOG_________________
[meet@ecolog_companion_task_1]:meet
meet_dialog	= {=is_wounded} axr_companion_medkit, {=squad_in_zone(ecolog_companion_task_1:mar_smart_terrain_base_sr_no_assault)} ecolog_companion_task_1_dialog, nil

[meet@ecolog_companion_task_2]:meet
meet_dialog	= {=is_wounded} axr_companion_medkit, {=check_nearest_smart_dist_le(40:jup_b41)} ecolog_companion_task_2_dialog, nil

[beh@base]:beh@general
on_info1 = {=check_squad_name(ecolog_companion_task_1)} beh@ecolog_companion_task_1, {=check_squad_name(ecolog_companion_task_2)} beh@ecolog_companion_task_2, {=check_squad_name(yan_ecolog_semenov_squad)} beh@yan_ecolog_semenov_task_1, {=check_squad_name(bandit_companion_task_1)} beh@bandit_companion_task_1

[beh@ecolog_companion_task_1]:beh@general
meet = meet@ecolog_companion_task_1
on_info1 = {=dist_to_task_target_anomaly_le(15)} beh@task_target_anomaly_1, {=squad_commander_active_section(beh@task_target_anomaly_1)} beh@task_target_anomaly_1
on_info2 = {-ecolog_companion_task_1_force_started =dist_to_actor_le(3)} %+ecolog_companion_task_1_force_started =force_talk(true)%

[beh@ecolog_companion_task_2]:beh@general
meet = meet@ecolog_companion_task_2
on_info1 = {=dist_to_task_target_anomaly_le(15)} beh@task_target_anomaly_1, {=squad_commander_active_section(beh@task_target_anomaly_1)} beh@task_target_anomaly_1
on_info2 = {-ecolog_companion_task_2_force_started =dist_to_actor_le(3)} %+ecolog_companion_task_2_force_started =force_talk(true)%

[beh@yan_ecolog_semenov_task_1]:beh@general
mutant_corpse_analysis = {=is_squad_commander !check_yan_ecolog_semenov_task_1_stage_1_complete} true
on_info1 = {-yan_ecolog_semenov_task_1_complete_force_dialog =dist_to_actor_le(3) =check_yan_ecolog_semenov_task_1_stage_1_complete =check_yan_ecolog_semenov_task_1_stage_2_complete} %+yan_ecolog_semenov_task_1_complete +yan_ecolog_semenov_task_1_complete_force_dialog =force_talk(true)%

;___________________BANDIT_________________
[meet@bandit_companion_task_1]:meet
meet_dialog	= {=is_wounded} axr_companion_medkit, bandit_companion_task_1_dialog

;TODO: Add logic to rob stalkers
[beh@bandit_companion_task_1]:beh@general
meet = meet@bandit_companion_task_1
;on_info1 = 
on_info2 = {-bandit_companion_task_1_force_started =dist_to_actor_le(3)} %+bandit_companion_task_1_force_started =force_talk(true)%
corpse_detection_enabled = true

;====================================================================
; 				special scenario active sections
;====================================================================
[beh@task_target_anomaly_1]:beh@general_no_companion
target = task_target_anomaly
wait_anim = scaner_crouch
on_info1 = {=is_squad_commander} beh@task_target_anomaly_2 %=play_sound(jup_b6_stalker_1_first_measurement_begin)%
on_info2 = {!has_task_target_anomaly} beh@ecolog_companion_task_1

[beh@task_target_anomaly_2]:beh@general_no_companion
target = task_target_anomaly
wait_anim = scaner_crouch
on_game_timer = 900 | %=play_sound(jup_b6_stalker_1_measurements_done) =reset_task_target_anomaly%
on_info2 = {!has_task_target_anomaly} beh@ecolog_companion_task_1